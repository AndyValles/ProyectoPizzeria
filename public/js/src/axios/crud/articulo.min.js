import { query, queryAll, load_on, base_url, base_root } from "../../../load.min.js";
import { Create, Edit, Delete, Buscar } from "../axios.min.js";

load_on(document, 'input', '.input-agregar-imagen', function(e) {
    var file = query(".input-agregar-imagen").files[0];
    var name = query(".input-agregar-imagen").files[0].name;
    var id = query('#CodigoInterno') != null ? query('#CodigoInterno').value : 0;
    query(".input-text-image").value = name;

    var formData = new FormData();
    formData.append("imagen", file);
    formData.append("name", name);

    axios({
        method: "post",
        url: base_url + "/imagen",
        data: formData,
        responseType: "json"
    }).then(function(resultado) {
        query("#ART_Imagen").value = resultado.data.ruta;
        query(".image-agregar").src = base_root + resultado.data.ruta;
    });
});

load_on(document, 'click', '.btn-agregar-modal', function(e) {

    let data = {
        ART_CodigoInterno: 0,
        ART_Nombre: query("#ART_Nombre").value,
        ART_Descripcion: query("#ART_Descripcion").value,
        ART_Precio: query("#ART_Precio").value,
        ART_Stock: query("#ART_Stock").value,
        ART_Imagen: query("#ART_Imagen").value,
        ART_Estado: "1",
        TIPART_CodigoInterno: query("#TIPART_CodigoInterno").getAttribute("data-id"),
        MAR_CodigoInterno: query("#MAR_CodigoInterno").getAttribute("data-id"),
        PROV_CodigoInterno: query("#PROV_CodigoInterno").getAttribute("data-id"),
    };

    Create(data);
});

load_on(document, 'click', '.btn-crud-edit', function(e) {
    let codigo = query('#CodigoInterno') != "" ? query('#CodigoInterno').value : 0;

    let data = {
        ART_CodigoInterno: codigo,
        ART_Nombre: query("#ART_Nombre").value,
        ART_Descripcion: query("#ART_Descripcion").value,
        ART_Precio: query("#ART_Precio").value,
        ART_Stock: query("#ART_Stock").value,
        ART_Imagen: query("#ART_Imagen").value,
        ART_Estado: "1",
        TIPART_CodigoInterno: query("#TIPART_CodigoInterno").getAttribute("data-id"),
        MAR_CodigoInterno: query("#MAR_CodigoInterno").getAttribute("data-id"),
        PROV_CodigoInterno: query("#PROV_CodigoInterno").getAttribute("data-id"),
    };

    Edit(codigo, data);
});

load_on(document, 'click', '.btn-filter-guardar', function(e) {
    let id = query('.general-id') != null ? query('.general-id').getAttribute("data-id") : 0;
    let data = {
        ART_CodigoInterno: id,
        ART_Nombre: "",
        ART_Descripcion: "",
        ART_Precio: "",
        ART_Stock: "",
        ART_Imagen: "",
        ART_Estado: "0",
        TIPART_CodigoInterno: "",
        MAR_CodigoInterno: "",
        PROV_CodigoInterno: "",
    };

    Delete(id, data);
});

load_on(document, 'click', '.btn-crud-Agregar', function(e) {
    let data = {
        ART_CodigoInterno: query("#Bus_ART_Codigo").value == "" ? "%%" : query("#Bus_ART_Codigo").value,
        ART_Nombre: query("#Bus_ART_Nombre").value == "" ? "%%" : query("#Bus_ART_Nombre").value,
        ART_Estado: query("#Bus_ART_Estado").value == "" ? "%%" : query("#Bus_ART_Estado").value,
        ART_Codigo: query("#Bus_ART_Codigo").value == "" ? "%%" : query("#Bus_ART_Codigo").value,
        ART_Nombre: query("#Bus_ART_Nombre").value == "" ? "%%" : query("#Bus_ART_Nombre").value,
        MAR_CodigoInterno: query("#BUS_MAR_Index").value == "" ? "%%" : query("#BUS_MAR_Index").value,
        PROV_CodigoInterno: query("#BUS_PROV_Index").value == "" ? "%%" : query("#BUS_PROV_Index").value,
        TIPART_CodigoInterno: query("#BUS_TIPART_Index").value == "" ? "%%" : query("#BUS_TIPART_Index").value,
    };

    Buscar(data);
});