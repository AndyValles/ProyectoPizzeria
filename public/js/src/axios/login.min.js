import { query, base_url, load_on, base_root, validateEmpty, queryAll } from "../../load.min.js";
import { iniciarsesion, Registrar, input } from "../query.min.js";


load_on(document, 'keyup', '.input-login', function(e) {
    query("#" + this.id + ' ~ .icon-info-p').innerHTML = "";
    query("#" + this.id).classList.remove("input-error");
});

load_on(document, 'click', '.btn-eye-contra', function(e) {
    let btn_eye = this.getAttribute("data-value");
    queryAll(".input").forEach(element => {
        var a = element.getAttribute("type") == input[0] ? input[1] : input[0];
        if (btn_eye == element.getAttribute("data-value")) {
            element.setAttribute("type", a);
        }
    });
    if (query("." + this.classList[1] + " .icon-eye") != null) {
        query("." + this.classList[1] + " .icon-eye").classList.replace("icon-eye", "icon-eye-blocked");
    } else {
        query("." + this.classList[1] + " .icon-eye-blocked").classList.replace("icon-eye-blocked", "icon-eye");
    }
});

load_on(document, 'click', '.btn-login-enviar', function(e) {
    var data = {
        USU_Usuario: query(iniciarsesion[0]).value,
        USU_Contra: query(iniciarsesion[1]).value,
        Remember: query("#cbk_user").value
    };

    if (validateEmpty(iniciarsesion)) {
        axios({
            method: "post",
            url: base_url + "/ingresar",
            data: data,
            responseType: "json"
        }).then(function(resultado) {
            if (resultado.data.succes) {
                window.location.href = base_root;
            } else {
                query(".ctn-text-error").innerHTML = resultado.data.mensage;
            }
        });
    }
});

load_on(document, 'click', ".btn-login-registrar", function(e) {
    if (validateEmpty(Registrar)) {
        var data = {
            USU_PriNombre: query("#USU_PriNombre").value,
            USU_SegNombre: query("#USU_SegNombre").value,
            USU_ApePaterno: query("#USU_ApePaterno").value,
            USU_ApeMaterno: query("#USU_ApeMaterno").value,
            USU_DNI: query("#USU_DNI").value,
            USU_Telefono: query("#USU_Telefono").value,
            USU_Correo: query("#USU_Correo").value,
            USU_Usuario: query("#USU_Usuario").value,
            USU_Contra: query("#USU_Contra").value,
        };

        axios({
            method: "post",
            url: base_root + "/Registro",
            data: data,
            responseType: "json"
        }).then(function(r) {
            window.location.href = base_root + "/iniciarsesion";
        }).catch(function(error) {

        });
    }
});